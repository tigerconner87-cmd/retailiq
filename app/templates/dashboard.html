<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dashboard — RetailIQ</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.7/dist/chart.umd.min.js"></script>
  <link rel="stylesheet" href="/static/dashboard.css?v=20">
</head>
<body>
  <!-- Sidebar -->
  <aside class="sidebar" id="sidebar">
    <div class="sidebar-header">
      <a href="/" class="logo">
        <svg width="28" height="28" viewBox="0 0 32 32" fill="none">
          <rect width="32" height="32" rx="8" fill="url(#lg)"/>
          <path d="M9 22V12l4 4 4-6 4 8v4" stroke="#fff" stroke-width="2.2" stroke-linecap="round" stroke-linejoin="round"/>
          <defs><linearGradient id="lg" x1="0" y1="0" x2="32" y2="32"><stop stop-color="#6366f1"/><stop offset="1" stop-color="#06b6d4"/></linearGradient></defs>
        </svg>
        <span>RetailIQ</span>
      </a>
    </div>
    <nav class="sidebar-nav">
      {% set sec = active_section|default('overview') %}
      <a href="/dashboard/briefing" class="nav-item {{ 'active' if sec == 'briefing' }}" data-section="briefing">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 8h1a4 4 0 0 1 0 8h-1"/><path d="M2 8h16v9a4 4 0 0 1-4 4H6a4 4 0 0 1-4-4V8z"/><line x1="6" y1="1" x2="6" y2="4"/><line x1="10" y1="1" x2="10" y2="4"/><line x1="14" y1="1" x2="14" y2="4"/></svg>
        Daily Briefing
      </a>
      <a href="/dashboard/data-hub" class="nav-item {{ 'active' if sec == 'datahub' }}" data-section="datahub">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><ellipse cx="12" cy="5" rx="9" ry="3"/><path d="M21 12c0 1.66-4 3-9 3s-9-1.34-9-3"/><path d="M3 5v14c0 1.66 4 3 9 3s9-1.34 9-3V5"/></svg>
        Data Hub
      </a>
      <a href="/dashboard" class="nav-item {{ 'active' if sec == 'overview' }}" data-section="overview">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="7" height="7"/><rect x="14" y="3" width="7" height="7"/><rect x="14" y="14" width="7" height="7"/><rect x="3" y="14" width="7" height="7"/></svg>
        Overview
      </a>
      <a href="/dashboard/sales" class="nav-item {{ 'active' if sec == 'sales' }}" data-section="sales">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="1" x2="12" y2="23"/><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/></svg>
        Sales
      </a>
      <a href="/dashboard/products" class="nav-item {{ 'active' if sec == 'products' }}" data-section="products">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M6 2L3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4z"/><line x1="3" y1="6" x2="21" y2="6"/><path d="M16 10a4 4 0 0 1-8 0"/></svg>
        Products
      </a>
      <a href="/dashboard/customers" class="nav-item {{ 'active' if sec == 'customers' }}" data-section="customers">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>
        Customers
      </a>
      <a href="/dashboard/competitors" class="nav-item {{ 'active' if sec == 'competitors' }}" data-section="competitors">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg>
        Competitors
      </a>
      <a href="/dashboard/goals" class="nav-item {{ 'active' if sec == 'goals' }}" data-section="goals">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><circle cx="12" cy="12" r="6"/><circle cx="12" cy="12" r="2"/></svg>
        Goals
      </a>
      <a href="/dashboard/marketing" class="nav-item {{ 'active' if sec == 'marketing' }}" data-section="marketing">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 15s1-1 4-1 5 2 8 2 4-1 4-1V3s-1 1-4 1-5-2-8-2-4 1-4 1z"/><line x1="4" y1="22" x2="4" y2="15"/></svg>
        Marketing
      </a>
      <a href="/dashboard/win-back" class="nav-item {{ 'active' if sec == 'winback' }}" data-section="winback">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"/></svg>
        Win-Back
      </a>
      <a href="/dashboard/reviews" class="nav-item {{ 'active' if sec == 'reviews' }}" data-section="reviews">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/></svg>
        Reviews
      </a>
      <a href="/dashboard/alerts" class="nav-item {{ 'active' if sec == 'alerts' }}" data-section="alerts">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"/><path d="M13.73 21a2 2 0 0 1-3.46 0"/></svg>
        Alerts
        <span class="badge" id="alertBadge" hidden>0</span>
      </a>
      <a href="/dashboard/settings" class="nav-item {{ 'active' if sec == 'settings' }}" data-section="settings">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06A1.65 1.65 0 0 0 4.68 15a1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06A1.65 1.65 0 0 0 9 4.68a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06A1.65 1.65 0 0 0 19.4 9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"/></svg>
        Settings
      </a>
    </nav>
    <div class="sidebar-footer">
      <a href="/dashboard/upgrade" class="sidebar-upgrade-link">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></svg>
        Upgrade Plan
      </a>
      <div class="sidebar-user-row">
        <div class="user-info">
          <div class="user-avatar">{{ user.full_name[:2]|upper }}</div>
          <div>
            <div class="user-name">{{ user.full_name }}</div>
            <div class="user-plan">{{ user.plan_tier|capitalize }} Plan</div>
          </div>
        </div>
        <button class="logout-btn" id="logoutBtn" title="Logout">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/><polyline points="16 17 21 12 16 7"/><line x1="21" y1="12" x2="9" y2="12"/></svg>
        </button>
      </div>
    </div>
  </aside>

  <!-- Main Content -->
  <main class="main">
    <header class="topbar">
      <button class="mobile-toggle" id="mobileToggle">
        <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="18" x2="21" y2="18"/></svg>
      </button>
      <div class="topbar-left">
        <div class="breadcrumb" id="breadcrumb">
          <span>Dashboard</span>
          <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><polyline points="9 18 15 12 9 6"/></svg>
          <span id="breadcrumbPage">Overview</span>
        </div>
        <h1 id="pageTitle">Overview</h1>
      </div>
      <div class="topbar-center">
        <div class="search-wrap" id="searchWrap">
          <svg class="search-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg>
          <input type="text" id="searchInput" class="search-input" placeholder="Search products, customers... (press /)" autocomplete="off">
          <kbd class="search-kbd">/</kbd>
          <div class="search-results" id="searchResults" hidden></div>
        </div>
      </div>
      <div class="topbar-right">
        <span class="last-updated" id="lastUpdated" title="Last data refresh">Updated just now</span>
        <span class="refresh-indicator" id="refreshIndicator" data-tooltip="Data auto-refreshes every 60 seconds" title="Auto-refreshes every 60s">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="23 4 23 10 17 10"/><path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10"/></svg>
        </span>
        <div class="notif-bell-wrap" id="notifBellWrap" onclick="toggleNotifications(event)">
          <button class="notif-bell-btn" id="notifBellBtn" title="Notifications" type="button">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"/><path d="M13.73 21a2 2 0 0 1-3.46 0"/></svg>
            <span class="notif-badge" id="notifBadge" hidden>0</span>
          </button>
          <div class="notif-dropdown" id="notifDropdown">
            <div class="notif-dropdown-header">
              <span class="notif-dropdown-title">Notifications</span>
              <button class="notif-mark-all" id="notifMarkAll" onclick="markAllNotificationsRead(event)">Mark All Read</button>
            </div>
            <div class="notif-dropdown-body" id="notifDropdownBody">
              <div class="ai-loading">Loading notifications...</div>
            </div>
            <div class="notif-dropdown-footer">
              <a href="#" id="notifViewAll" onclick="goToAlerts(event)">View All Alerts</a>
            </div>
          </div>
        </div>
        <button class="theme-toggle" id="themeToggle" data-tooltip="Switch between dark and light theme" title="Toggle theme">
          <svg class="icon-sun" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg>
          <svg class="icon-moon" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1 1 11.21 3a7 7 0 0 0 9.79 9.79z"/></svg>
        </button>
      </div>
    </header>

    {% if show_trial_banner %}
    <div class="trial-banner" id="trialBanner">
      <div class="trial-banner-left">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>
        <span>Free Trial: <strong>{{ trial_days }} day{{ 's' if trial_days != 1 else '' }}</strong> remaining</span>
      </div>
      <a href="/dashboard/upgrade" class="trial-banner-btn">Upgrade Now</a>
    </div>
    {% endif %}

    {% if welcome %}
    <div class="welcome-banner" id="welcomeBanner">
      <div class="welcome-banner-content">
        <div class="welcome-emoji">&#127881;</div>
        <div>
          <div class="welcome-title">Welcome to RetailIQ!</div>
          <div class="welcome-sub">Your dashboard is ready with 30 days of starter data. Explore your analytics below.</div>
        </div>
      </div>
      <button class="welcome-dismiss" id="welcomeDismiss">&times;</button>
    </div>
    {% endif %}

    <!-- Quick Stats Bar -->
    <div class="quick-stats-bar" id="quickStatsBar">
      <div class="quick-stat-item">
        <span class="quick-stat-icon">&#128202;</span>
        <span>Today: <strong id="qsRevenue">--</strong></span>
      </div>
      <div class="quick-stat-item">
        <span class="quick-stat-icon">&#128230;</span>
        <span><strong id="qsTransactions">--</strong> transactions</span>
      </div>
      <div class="quick-stat-item">
        <span class="quick-stat-icon">&#128101;</span>
        <span><strong id="qsCustomers">--</strong> customers</span>
      </div>
      <div class="quick-stat-item">
        <span class="quick-stat-icon">&#11088;</span>
        <span><strong id="qsRating">--</strong> rating</span>
      </div>
    </div>

    <div class="content" id="content">
      <!-- Daily Briefing Section -->
      <section class="section {{ 'active' if sec == 'briefing' }}" id="sec-briefing">
        <div class="briefing-hero" id="briefingHero">
          <div class="briefing-greeting" id="briefingGreeting">Good morning!</div>
          <div class="briefing-date" id="briefingDate"></div>
        </div>

        <!-- Numbers Today -->
        <div class="briefing-section">
          <h3 class="briefing-section-title">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="1" x2="12" y2="23"/><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/></svg>
            Your Numbers Today
          </h3>
          <div class="briefing-numbers" id="briefingNumbers">
            <div class="briefing-num-card">
              <div class="briefing-num-label">Yesterday's Revenue</div>
              <div class="briefing-num-value" id="brfRevenue">--</div>
              <div class="briefing-num-change" id="brfRevChange">--</div>
            </div>
            <div class="briefing-num-card">
              <div class="briefing-num-label">Transactions</div>
              <div class="briefing-num-value" id="brfTransactions">--</div>
              <div class="briefing-num-change" id="brfTxnChange">--</div>
            </div>
            <div class="briefing-num-card">
              <div class="briefing-num-label">Avg Order Value</div>
              <div class="briefing-num-value" id="brfAov">--</div>
              <div class="briefing-num-sub">per transaction</div>
            </div>
            <div class="briefing-num-card goal-card-brief">
              <div class="briefing-num-label">Monthly Goal</div>
              <div class="briefing-num-value" id="brfGoalPct">--</div>
              <div class="briefing-goal-bar"><div class="briefing-goal-fill" id="brfGoalFill"></div></div>
              <div class="briefing-num-sub" id="brfGoalSub">--</div>
            </div>
          </div>
        </div>

        <!-- Top 3 Things To Do -->
        <div class="briefing-section">
          <h3 class="briefing-section-title">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="9 11 12 14 22 4"/><path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"/></svg>
            Top 3 Things To Do Today
          </h3>
          <div class="briefing-todos" id="briefingTodos">
            <div class="ai-loading">Analyzing your data...</div>
          </div>
        </div>

        <div class="briefing-grid-2">
          <!-- Competitor Watch -->
          <div class="briefing-section">
            <h3 class="briefing-section-title">
              <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg>
              Competitor Watch
            </h3>
            <div class="briefing-comp-list" id="briefingCompWatch">
              <div class="ai-loading">Loading...</div>
            </div>
          </div>

          <!-- Customer Pulse -->
          <div class="briefing-section">
            <h3 class="briefing-section-title">
              <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>
              Customer Pulse
            </h3>
            <div class="briefing-pulse" id="briefingPulse">
              <div class="ai-loading">Loading...</div>
            </div>
          </div>
        </div>

        <!-- This Week's Marketing -->
        <div class="briefing-section">
          <h3 class="briefing-section-title">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 15s1-1 4-1 5 2 8 2 4-1 4-1V3s-1 1-4 1-5-2-8-2-4 1-4 1z"/><line x1="4" y1="22" x2="4" y2="15"/></svg>
            Today's Marketing Tip
          </h3>
          <div class="briefing-marketing" id="briefingMarketing">
            <div class="ai-loading">Loading...</div>
          </div>
        </div>
      </section>

      <!-- Data Hub Section -->
      <section class="section {{ 'active' if sec == 'datahub' }}" id="sec-datahub">
        <div class="dh-tabs" id="dhTabs">
          <button class="dh-tab active" data-tab="quick-entry">Quick Entry</button>
          <button class="dh-tab" data-tab="csv-upload">CSV Upload</button>
          <button class="dh-tab" data-tab="dh-products">Products</button>
          <button class="dh-tab" data-tab="dh-customers">Customers</button>
          <button class="dh-tab" data-tab="connections">Connections</button>
        </div>

        <!-- Tab: Quick Entry -->
        <div class="dh-panel active" id="dhPanel-quick-entry">
          <div class="grid-2">
            <div class="card">
              <div class="card-header"><h3>Log Today's Sales</h3><span class="ai-tag">2 min</span></div>
              <div class="card-body">
                <div class="dh-form" id="dhDailyForm">
                  <div class="dh-field">
                    <label class="dh-label">Date</label>
                    <input type="date" class="dh-input" id="dhDate">
                  </div>
                  <div class="dh-field-row">
                    <div class="dh-field">
                      <label class="dh-label">Total Revenue ($)</label>
                      <input type="number" class="dh-input" id="dhRevenue" placeholder="e.g. 1247.50" step="0.01">
                    </div>
                    <div class="dh-field">
                      <label class="dh-label">Transactions</label>
                      <input type="number" class="dh-input" id="dhTransactions" placeholder="e.g. 23">
                    </div>
                  </div>
                  <div class="dh-field">
                    <label class="dh-label">Walk-in Customers</label>
                    <input type="number" class="dh-input" id="dhCustomers" placeholder="e.g. 35">
                  </div>
                  <div class="dh-field">
                    <label class="dh-label">Notes (optional)</label>
                    <input type="text" class="dh-input" id="dhNotes" placeholder='e.g. "Ran a 20% off sale today"'>
                  </div>
                  <details class="dh-details">
                    <summary class="dh-summary">Add Individual Sales (optional)</summary>
                    <div class="dh-items-list" id="dhItemsList">
                      <div class="dh-item-row">
                        <input type="text" class="dh-input dh-input-sm" placeholder="Product name" list="dhProductList">
                        <input type="number" class="dh-input dh-input-xs" placeholder="Qty" min="1" value="1">
                        <input type="number" class="dh-input dh-input-sm" placeholder="Price" step="0.01">
                        <button class="dh-remove-btn" onclick="this.parentElement.remove()" title="Remove">&times;</button>
                      </div>
                    </div>
                    <datalist id="dhProductList"></datalist>
                    <button class="dh-add-item-btn" id="dhAddItem">+ Add Another Product</button>
                  </details>
                  <button class="btn-primary dh-save-btn" id="dhSaveDaily">Save Today's Data</button>
                </div>
                <div class="dh-result" id="dhDailyResult" hidden></div>
              </div>
            </div>
            <div class="card">
              <div class="card-header"><h3>Entry Calendar</h3></div>
              <div class="card-body">
                <div class="dh-streak" id="dhStreak"></div>
                <div class="dh-calendar" id="dhCalendar">
                  <div class="ai-loading">Loading calendar...</div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Tab: CSV Upload -->
        <div class="dh-panel" id="dhPanel-csv-upload">
          <div class="card">
            <div class="card-header"><h3>Upload Sales Data</h3></div>
            <div class="card-body">
              <div class="dh-upload-zone" id="dhUploadZone">
                <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" y1="3" x2="12" y2="15"/></svg>
                <div class="dh-upload-text">Drag &amp; drop your CSV file here, or <label class="dh-upload-link">browse<input type="file" id="dhFileInput" accept=".csv" hidden></label></div>
                <div class="dh-upload-sub">We accept CSV exports from: Shopify, Square, Clover, Lightspeed, Toast, Vend, or any custom format</div>
              </div>
              <div class="dh-csv-preview" id="dhCsvPreview" hidden>
                <h4 class="dh-preview-title" id="dhPreviewTitle"></h4>
                <div class="dh-preview-table-wrap">
                  <table class="data-table" id="dhPreviewTable"><thead></thead><tbody></tbody></table>
                </div>
                <div class="dh-mapping">
                  <h4>Map Your Columns</h4>
                  <div class="dh-mapping-grid" id="dhMappingGrid">
                    <div class="dh-map-field"><label>Date Column <span class="required">*</span></label><select class="dh-input" id="dhMapDate"></select></div>
                    <div class="dh-map-field"><label>Revenue/Total Column <span class="required">*</span></label><select class="dh-input" id="dhMapRevenue"></select></div>
                    <div class="dh-map-field"><label>Product Name (optional)</label><select class="dh-input" id="dhMapProduct"></select></div>
                    <div class="dh-map-field"><label>Quantity (optional)</label><select class="dh-input" id="dhMapQuantity"></select></div>
                    <div class="dh-map-field"><label>Customer Email (optional)</label><select class="dh-input" id="dhMapCustomer"></select></div>
                  </div>
                </div>
                <div class="dh-import-actions">
                  <button class="btn-primary" id="dhImportBtn">Import Data</button>
                  <button class="dh-cancel-btn" id="dhCancelImport">Cancel</button>
                </div>
                <div class="dh-import-result" id="dhImportResult" hidden></div>
              </div>
            </div>
          </div>
        </div>

        <!-- Tab: Products -->
        <div class="dh-panel" id="dhPanel-dh-products">
          <div class="card">
            <div class="card-header">
              <h3>Product Catalog</h3>
              <div class="dh-header-actions">
                <label class="dh-upload-mini-btn">Import CSV<input type="file" id="dhProductCsvInput" accept=".csv" hidden></label>
                <button class="btn-primary" id="dhAddProductBtn">+ Add Product</button>
              </div>
            </div>
            <div class="card-body">
              <p class="dh-hint">Products power your analytics — the more products you add, the better your insights.</p>
              <div class="dh-product-form" id="dhProductForm" hidden>
                <div class="dh-field-row">
                  <div class="dh-field"><label class="dh-label">Product Name *</label><input type="text" class="dh-input" id="dhProdName"></div>
                  <div class="dh-field"><label class="dh-label">Category</label><select class="dh-input" id="dhProdCategory"><option value="">Select...</option><option>Clothing</option><option>Accessories</option><option>Food & Beverage</option><option>Electronics</option><option>Home & Garden</option><option>Beauty</option><option>Health</option><option>Books</option><option>Gifts</option><option>Other</option></select></div>
                </div>
                <div class="dh-field-row">
                  <div class="dh-field"><label class="dh-label">Selling Price ($) *</label><input type="number" class="dh-input" id="dhProdPrice" step="0.01"></div>
                  <div class="dh-field"><label class="dh-label">Cost Price ($)</label><input type="number" class="dh-input" id="dhProdCost" step="0.01"></div>
                  <div class="dh-field"><label class="dh-label">SKU</label><input type="text" class="dh-input" id="dhProdSku"></div>
                </div>
                <div class="dh-form-actions">
                  <button class="btn-primary" id="dhSaveProduct">Save Product</button>
                  <button class="dh-cancel-btn" id="dhCancelProduct">Cancel</button>
                </div>
                <input type="hidden" id="dhProdEditId">
              </div>
              <table class="data-table" id="dhProductsTable">
                <thead><tr><th>Name</th><th>Category</th><th>Price</th><th>Cost</th><th>SKU</th><th>Status</th><th>Actions</th></tr></thead>
                <tbody></tbody>
              </table>
            </div>
          </div>
        </div>

        <!-- Tab: Customers -->
        <div class="dh-panel" id="dhPanel-dh-customers">
          <div class="card">
            <div class="card-header">
              <h3>Customer Database</h3>
              <div class="dh-header-actions">
                <label class="dh-upload-mini-btn">Import CSV<input type="file" id="dhCustomerCsvInput" accept=".csv" hidden></label>
                <button class="btn-primary" id="dhAddCustomerBtn">+ Add Customer</button>
              </div>
            </div>
            <div class="card-body">
              <p class="dh-hint">Customers power your win-back campaigns — add emails to enable automated outreach.</p>
              <div class="dh-product-form" id="dhCustomerForm" hidden>
                <div class="dh-field-row">
                  <div class="dh-field"><label class="dh-label">Email</label><input type="email" class="dh-input" id="dhCustEmail"></div>
                  <div class="dh-field"><label class="dh-label">Segment</label><select class="dh-input" id="dhCustSegment"><option value="regular">Regular</option><option value="vip">VIP</option><option value="at_risk">At Risk</option><option value="lost">Lost</option></select></div>
                </div>
                <div class="dh-form-actions">
                  <button class="btn-primary" id="dhSaveCustomer">Save Customer</button>
                  <button class="dh-cancel-btn" id="dhCancelCustomer">Cancel</button>
                </div>
                <input type="hidden" id="dhCustEditId">
              </div>
              <div class="dh-search-bar">
                <input type="text" class="dh-input" id="dhCustSearch" placeholder="Search by email...">
              </div>
              <table class="data-table" id="dhCustomersTable">
                <thead><tr><th>Email</th><th>Segment</th><th>Visits</th><th>Total Spent</th><th>Last Seen</th><th>Actions</th></tr></thead>
                <tbody></tbody>
              </table>
              <div class="dh-pagination" id="dhCustPagination"></div>
            </div>
          </div>
        </div>

        <!-- Tab: Connections -->
        <div class="dh-panel" id="dhPanel-connections">
          <div class="dh-connections-grid">
            <!-- Google Business Profile -->
            <div class="dh-connection-card connected-ready" id="dhGoogleCard">
              <div class="dh-conn-icon" style="background:linear-gradient(135deg,#4285f4,#34a853)">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#fff" stroke-width="2"><path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"/><circle cx="12" cy="10" r="3"/></svg>
              </div>
              <div class="dh-conn-info">
                <div class="dh-conn-name">Google Business Profile</div>
                <div class="dh-conn-desc">Import your Google reviews and monitor competitor reviews in real-time</div>
                <div class="dh-conn-status" id="dhGoogleStatus">Not connected</div>
              </div>
              <button class="btn-primary dh-conn-btn" id="dhGoogleConnectBtn">Connect</button>
            </div>

            <!-- Shopify -->
            <div class="dh-connection-card coming-soon-card">
              <div class="dh-conn-icon" style="background:linear-gradient(135deg,#96bf48,#5e8e3e)">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#fff" stroke-width="2"><path d="M6 2L3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4z"/><line x1="3" y1="6" x2="21" y2="6"/><path d="M16 10a4 4 0 0 1-8 0"/></svg>
              </div>
              <div class="dh-conn-info">
                <div class="dh-conn-name">Shopify</div>
                <div class="dh-conn-desc">Auto-sync products, orders, and customers from your Shopify store</div>
                <span class="coming-soon-badge">Coming Soon</span>
              </div>
              <div class="dh-notify-wrap"><input type="email" class="dh-input dh-notify-email" placeholder="Your email"><button class="dh-notify-btn" data-integration="shopify">Notify Me</button></div>
            </div>

            <!-- Square -->
            <div class="dh-connection-card coming-soon-card">
              <div class="dh-conn-icon" style="background:linear-gradient(135deg,#006aff,#0051cc)">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#fff" stroke-width="2"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"/><rect x="8" y="8" width="8" height="8"/></svg>
              </div>
              <div class="dh-conn-info">
                <div class="dh-conn-name">Square</div>
                <div class="dh-conn-desc">Import transactions and inventory from your Square POS</div>
                <span class="coming-soon-badge">Coming Soon</span>
              </div>
              <div class="dh-notify-wrap"><input type="email" class="dh-input dh-notify-email" placeholder="Your email"><button class="dh-notify-btn" data-integration="square">Notify Me</button></div>
            </div>

            <!-- Clover -->
            <div class="dh-connection-card coming-soon-card">
              <div class="dh-conn-icon" style="background:linear-gradient(135deg,#43b02a,#2d8a1e)">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#fff" stroke-width="2"><circle cx="12" cy="8" r="4"/><circle cx="8" cy="14" r="4"/><circle cx="16" cy="14" r="4"/></svg>
              </div>
              <div class="dh-conn-info">
                <div class="dh-conn-name">Clover</div>
                <div class="dh-conn-desc">Sync sales, inventory, and customer data from Clover POS</div>
                <span class="coming-soon-badge">Coming Soon</span>
              </div>
              <div class="dh-notify-wrap"><input type="email" class="dh-input dh-notify-email" placeholder="Your email"><button class="dh-notify-btn" data-integration="clover">Notify Me</button></div>
            </div>

            <!-- Instagram -->
            <div class="dh-connection-card coming-soon-card">
              <div class="dh-conn-icon" style="background:linear-gradient(135deg,#f09433,#e6683c,#dc2743,#cc2366,#bc1888)">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#fff" stroke-width="2"><rect x="2" y="2" width="20" height="20" rx="5" ry="5"/><path d="M16 11.37A4 4 0 1 1 12.63 8 4 4 0 0 1 16 11.37z"/><line x1="17.5" y1="6.5" x2="17.51" y2="6.5"/></svg>
              </div>
              <div class="dh-conn-info">
                <div class="dh-conn-name">Instagram</div>
                <div class="dh-conn-desc">Track follower growth, post engagement, and social mentions</div>
                <span class="coming-soon-badge">Coming Soon</span>
              </div>
              <div class="dh-notify-wrap"><input type="email" class="dh-input dh-notify-email" placeholder="Your email"><button class="dh-notify-btn" data-integration="instagram">Notify Me</button></div>
            </div>

            <!-- QuickBooks -->
            <div class="dh-connection-card coming-soon-card">
              <div class="dh-conn-icon" style="background:linear-gradient(135deg,#2ca01c,#108a00)">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#fff" stroke-width="2"><line x1="12" y1="1" x2="12" y2="23"/><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/></svg>
              </div>
              <div class="dh-conn-info">
                <div class="dh-conn-name">QuickBooks</div>
                <div class="dh-conn-desc">Sync expenses, revenue, and financial data for accurate profit tracking</div>
                <span class="coming-soon-badge">Coming Soon</span>
              </div>
              <div class="dh-notify-wrap"><input type="email" class="dh-input dh-notify-email" placeholder="Your email"><button class="dh-notify-btn" data-integration="quickbooks">Notify Me</button></div>
            </div>
          </div>

          <!-- Google Business Finder Modal -->
          <div class="dh-modal-overlay" id="dhGoogleModal" hidden onclick="if(event.target===this)this.hidden=true">
            <div class="dh-modal">
              <div class="dh-modal-header">
                <h3 id="dhGoogleModalTitle">Find Your Business on Google</h3>
                <button class="dh-modal-close" id="dhGoogleModalClose" onclick="document.getElementById('dhGoogleModal').hidden=true">&times;</button>
              </div>
              <div class="dh-modal-body">
                <div class="dh-modal-step" id="dhGoogleStep1">
                  <div class="dh-field-row">
                    <div class="dh-field" style="flex:2"><input type="text" class="dh-input" id="dhGoogleSearch" placeholder="Your business name + city"></div>
                    <button class="btn-primary" id="dhGoogleSearchBtn">Search</button>
                  </div>
                  <div class="dh-google-results" id="dhGoogleResults">
                    <div class="dh-hint" style="text-align:center;padding:30px">Search for your business to get started</div>
                  </div>
                </div>
                <div class="dh-modal-step" id="dhGoogleStep2" hidden>
                  <p class="dh-hint">Now let's find your competitors. We found similar businesses near you:</p>
                  <div class="dh-google-results" id="dhCompetitorResults">
                    <div class="ai-loading">Searching for nearby businesses...</div>
                  </div>
                  <div class="dh-field-row" style="margin-top:16px">
                    <div class="dh-field" style="flex:2"><input type="text" class="dh-input" id="dhCompSearch" placeholder="Search for a specific competitor"></div>
                    <button class="btn-primary" id="dhCompSearchBtn">Search</button>
                  </div>
                  <div class="dh-modal-footer">
                    <button class="btn-primary" id="dhFinishCompetitors">Done — Save Competitors</button>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- Overview Section -->
      <section class="section {{ 'active' if sec == 'overview' }}" id="sec-overview">
        <!-- Insights Strip -->
        <div class="insight-strip" id="insightStrip"></div>

        <!-- AI Action Items -->
        <div class="ai-actions-card" id="aiActionsCard">
          <div class="ai-actions-header">
            <div class="ai-actions-title">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></svg>
              AI Action Items
              <span class="ai-tag">Updated daily</span>
            </div>
          </div>
          <div class="ai-actions-body" id="aiActionsBody">
            <div class="ai-loading">Analyzing your data...</div>
          </div>
        </div>

        <!-- Quick Actions Bar -->
        <div class="quick-actions" id="quickActions">
          <button class="qa-btn" onclick="document.querySelector('.nav-item[data-section=&quot;marketing&quot;]').click()">&#128221; Create Post</button>
          <button class="qa-btn" onclick="document.querySelector('.nav-item[data-section=&quot;winback&quot;]').click()">&#128231; Send Campaign</button>
          <button class="qa-btn" onclick="document.querySelector('.nav-item[data-section=&quot;competitors&quot;]').click()">&#128269; Check Competitors</button>
          <button class="qa-btn" onclick="document.querySelector('.nav-item[data-section=&quot;briefing&quot;]').click()">&#128202; View Report</button>
          <button class="qa-btn" onclick="document.querySelector('.nav-item[data-section=&quot;goals&quot;]').click()">&#127919; Update Goals</button>
        </div>

        <div class="kpi-grid" id="kpiGrid">
          <div class="kpi-card" data-tooltip="Total revenue earned today (or latest data date)">
            <div class="kpi-label">Revenue Today</div>
            <div class="kpi-value" id="kpiRevenue">--</div>
            <div class="kpi-change" id="kpiRevenueDod">--</div>
          </div>
          <div class="kpi-card" data-tooltip="Number of completed sales transactions today">
            <div class="kpi-label">Transactions</div>
            <div class="kpi-value" id="kpiTransactions">--</div>
            <div class="kpi-sub">today</div>
          </div>
          <div class="kpi-card" data-tooltip="Average revenue per transaction (revenue / transactions)">
            <div class="kpi-label">Avg Order Value</div>
            <div class="kpi-value" id="kpiAov">--</div>
            <div class="kpi-sub">per transaction</div>
          </div>
          <div class="kpi-card" data-tooltip="Percentage of customers who have visited more than once">
            <div class="kpi-label">Repeat Customers</div>
            <div class="kpi-value" id="kpiRepeat">--</div>
            <div class="kpi-sub">return rate</div>
          </div>
        </div>

        <div class="chart-row">
          <div class="card chart-card wide">
            <div class="card-header">
              <h3>Revenue — Last 30 Days</h3>
            </div>
            <div class="card-body">
              <canvas id="revenueChart"></canvas>
            </div>
          </div>
          <div class="card chart-card">
            <div class="card-header">
              <h3>Peak Hours</h3>
            </div>
            <div class="card-body">
              <div class="heatmap-container" id="heatmap"></div>
            </div>
          </div>
        </div>

        <div class="chart-row">
          <div class="card">
            <div class="card-header"><h3>Top Products</h3></div>
            <div class="card-body">
              <table class="data-table" id="productsTableOverview">
                <thead><tr><th>Product</th><th>Revenue</th><th>Units</th></tr></thead>
                <tbody></tbody>
              </table>
            </div>
          </div>
          <div class="card">
            <div class="card-header"><h3>Recent Alerts</h3></div>
            <div class="card-body">
              <div class="alert-list" id="alertListOverview"></div>
            </div>
          </div>
        </div>

        <!-- Activity Feed -->
        <div class="card mt">
          <div class="card-header"><h3>Live Activity Feed</h3><span class="ai-tag">Real-time</span></div>
          <div class="card-body" id="activityFeedBody">
            <div class="ai-loading">Loading activity...</div>
          </div>
        </div>
      </section>

      <!-- Sales Section -->
      <section class="section {{ 'active' if sec == 'sales' }}" id="sec-sales">
        <div class="section-toolbar">
          <button class="export-btn" onclick="exportCSV('sales')">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>
            Export CSV
          </button>
        </div>
        <div class="card">
          <div class="card-header"><h3>Sales Trend</h3></div>
          <div class="card-body"><canvas id="salesChartFull"></canvas></div>
        </div>
        <div class="grid-2 mt">
          <div class="card">
            <div class="card-header"><h3>Weekly Summary</h3></div>
            <div class="card-body"><table class="data-table" id="weeklyTable"><thead><tr><th>Week</th><th>Revenue</th><th>Transactions</th></tr></thead><tbody></tbody></table></div>
          </div>
          <div class="card">
            <div class="card-header"><h3>Monthly Summary</h3></div>
            <div class="card-body"><table class="data-table" id="monthlyTable"><thead><tr><th>Month</th><th>Revenue</th><th>Transactions</th></tr></thead><tbody></tbody></table></div>
          </div>
        </div>
        <!-- Revenue Heatmap Calendar -->
        <div class="card mt" id="revenueHeatmapCard">
          <div class="card-header"><h3>Revenue Heatmap — Last 90 Days</h3></div>
          <div class="card-body" id="revenueHeatmapBody">
            <div class="ai-loading">Building heatmap...</div>
          </div>
        </div>
        <!-- Break-Even Analysis -->
        <div class="card mt" id="breakEvenCard">
          <div class="card-header"><h3>Break-Even Analysis</h3><span class="ai-tag">AI-powered</span></div>
          <div class="card-body" id="breakEvenBody">
            <div class="ai-loading">Calculating break-even metrics...</div>
          </div>
        </div>
      </section>

      <!-- Products Section -->
      <section class="section {{ 'active' if sec == 'products' }}" id="sec-products">
        <div class="section-toolbar">
          <button class="export-btn" onclick="exportCSV('products')">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>
            Export CSV
          </button>
        </div>
        <div class="card">
          <div class="card-header"><h3>Product Performance Rankings</h3></div>
          <div class="card-body">
            <table class="data-table" id="productsTableFull">
              <thead><tr><th>#</th><th>Product</th><th>Category</th><th>Revenue</th><th>Units Sold</th><th>Avg Price</th><th>Margin</th></tr></thead>
              <tbody></tbody>
            </table>
          </div>
        </div>
        <!-- Product Performance Cards -->
        <div class="card mt">
          <div class="card-header"><h3>Product Performance Overview</h3></div>
          <div class="card-body" id="productPerfBody">
            <div class="ai-loading">Loading performance cards...</div>
          </div>
        </div>
        <!-- AI Product Recommendations -->
        <div class="card mt" id="productRecsCard">
          <div class="card-header"><h3>AI Product Recommendations</h3><span class="ai-tag">AI-powered</span></div>
          <div class="card-body" id="productRecsBody">
            <div class="ai-loading">Analyzing product data...</div>
          </div>
        </div>
      </section>

      <!-- Customers Section -->
      <section class="section {{ 'active' if sec == 'customers' }}" id="sec-customers">
        <div class="section-toolbar">
          <button class="export-btn" onclick="exportCSV('customers')">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>
            Export CSV
          </button>
        </div>
        <div class="kpi-grid small">
          <div class="kpi-card"><div class="kpi-label">Total Customers</div><div class="kpi-value" id="custTotal">--</div></div>
          <div class="kpi-card"><div class="kpi-label">Repeat Rate</div><div class="kpi-value" id="custRepeat">--</div></div>
          <div class="kpi-card"><div class="kpi-label">New (30d)</div><div class="kpi-value" id="custNew">--</div></div>
          <div class="kpi-card"><div class="kpi-label">Avg Revenue/Customer</div><div class="kpi-value" id="custAvgRev">--</div></div>
        </div>
        <div class="card mt">
          <div class="card-header"><h3>Top Customers by Spend</h3></div>
          <div class="card-body">
            <table class="data-table" id="topCustomersTable">
              <thead><tr><th>#</th><th>Customer</th><th>Visits</th><th>Total Spent</th><th>Last Seen</th></tr></thead>
              <tbody></tbody>
            </table>
          </div>
        </div>

        <!-- Customer Segments Visualization -->
        <div class="card mt">
          <div class="card-header"><h3>Customer Segments</h3><span class="ai-tag">Auto-segmented</span></div>
          <div class="card-body" id="customerSegmentsBody">
            <div class="ai-loading">Analyzing customer segments...</div>
          </div>
        </div>
      </section>

      <!-- Competitors Section (Full Intelligence Dashboard) -->
      <section class="section {{ 'active' if sec == 'competitors' }}" id="sec-competitors">
        <!-- Competitor header with sync button -->
        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px">
          <div style="display:flex;align-items:center;gap:12px">
            <span class="comp-sync-status" id="compSyncStatus" style="font-size:12px;color:var(--text-secondary)"></span>
          </div>
          <button class="btn-primary" id="compRefreshReviews" style="font-size:13px;padding:6px 14px;display:flex;align-items:center;gap:6px" title="Sync competitor reviews from Google">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="23 4 23 10 17 10"/><polyline points="1 20 1 14 7 14"/><path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"/></svg>
            Refresh Reviews
          </button>
        </div>
        <!-- Sub-navigation tabs -->
        <div class="comp-tabs" id="compTabs">
          <button class="comp-tab active" data-tab="overview">Overview</button>
          <button class="comp-tab" data-tab="comparison">Comparison</button>
          <button class="comp-tab" data-tab="opportunities">Opportunities</button>
          <button class="comp-tab" data-tab="review-feed">Review Feed</button>
          <button class="comp-tab" data-tab="sentiment">Sentiment</button>
          <button class="comp-tab" data-tab="market-map">Market Map</button>
          <button class="comp-tab" data-tab="weekly-report">Weekly Report</button>
          <button class="comp-tab" data-tab="trend-alerts">Trend Alerts</button>
          <button class="comp-tab" data-tab="response-analysis">Response</button>
          <button class="comp-tab" data-tab="advantages">Advantages</button>
          <button class="comp-tab" data-tab="marketing">Marketing</button>
        </div>

        <!-- Tab: Overview -->
        <div class="comp-panel active" id="compPanel-overview">
          <div class="comp-cards-grid" id="compCardsGrid">
            <div class="ai-loading">Loading competitor data...</div>
          </div>
        </div>

        <!-- Tab: Comparison -->
        <div class="comp-panel" id="compPanel-comparison">
          <div class="card">
            <div class="card-header"><h3>Side-by-Side Competitor Comparison</h3></div>
            <div class="card-body comp-table-wrap">
              <table class="data-table comp-comparison-table" id="compComparisonTable">
                <thead><tr><th>Business</th><th>Rating</th><th>Reviews</th><th>Response Rate</th><th>Sentiment</th><th>Est. Traffic</th><th>Strengths</th><th>Weaknesses</th></tr></thead>
                <tbody></tbody>
              </table>
            </div>
          </div>
        </div>

        <!-- Tab: Opportunities -->
        <div class="comp-panel" id="compPanel-opportunities">
          <div class="opp-list" id="oppList">
            <div class="ai-loading">Detecting opportunities...</div>
          </div>
        </div>

        <!-- Tab: Review Feed -->
        <div class="comp-panel" id="compPanel-review-feed">
          <div class="comp-filters" id="compFilters">
            <select id="filterCompetitor"><option value="">All Competitors</option></select>
            <select id="filterRating"><option value="">All Ratings</option><option value="1">1 Star</option><option value="2">2 Stars</option><option value="3">3 Stars</option><option value="4">4 Stars</option><option value="5">5 Stars</option></select>
            <select id="filterSentiment"><option value="">All Sentiments</option><option value="positive">Positive</option><option value="neutral">Neutral</option><option value="negative">Negative</option></select>
          </div>
          <div class="review-list" id="compReviewFeed"></div>
        </div>

        <!-- Tab: Sentiment -->
        <div class="comp-panel" id="compPanel-sentiment">
          <div class="sentiment-grid" id="sentimentGrid"></div>
        </div>

        <!-- Tab: Market Map -->
        <div class="comp-panel" id="compPanel-market-map">
          <div class="card">
            <div class="card-header"><h3>Market Position Map</h3><span class="card-sub">X: Review Volume | Y: Rating</span></div>
            <div class="card-body">
              <div class="market-map-container">
                <canvas id="marketMapChart"></canvas>
              </div>
            </div>
          </div>
        </div>

        <!-- Tab: Weekly Report -->
        <div class="comp-panel" id="compPanel-weekly-report">
          <div class="weekly-report" id="weeklyReport"></div>
        </div>

        <!-- Tab: Trend Alerts -->
        <div class="comp-panel" id="compPanel-trend-alerts">
          <div class="trend-alerts-list" id="trendAlertsList">
            <div class="ai-loading">Scanning for trend changes...</div>
          </div>
        </div>

        <!-- Tab: Response Analysis -->
        <div class="comp-panel" id="compPanel-response-analysis">
          <div class="response-analysis" id="responseAnalysis">
            <div class="ai-loading">Analyzing response rates...</div>
          </div>
        </div>

        <!-- Tab: Competitive Advantages -->
        <div class="comp-panel" id="compPanel-advantages">
          <div class="advantages-dashboard" id="advantagesDashboard">
            <div class="ai-loading">Finding your competitive edges...</div>
          </div>
        </div>

        <!-- Tab: Marketing Responses -->
        <div class="comp-panel" id="compPanel-marketing">
          <div class="marketing-filters">
            <button class="mkt-filter-btn active" data-status="">All</button>
            <button class="mkt-filter-btn" data-status="new">New</button>
            <button class="mkt-filter-btn" data-status="saved">Saved</button>
            <button class="mkt-filter-btn" data-status="used">Used</button>
          </div>
          <div class="marketing-list" id="marketingList"></div>
        </div>

        <!-- Competitor Price Comparison Teaser -->
        <div class="card mt comp-price-teaser">
          <div class="card-body" style="text-align:center;padding:40px 24px">
            <div style="font-size:48px;margin-bottom:16px">&#128176;</div>
            <h3 style="margin-bottom:8px;font-size:18px">Price Comparison Intelligence</h3>
            <p style="color:var(--text2);font-size:14px;max-width:400px;margin:0 auto 20px;line-height:1.6">Compare your pricing against competitors in real-time. Get alerts when competitors change prices and find opportunities to optimize.</p>
            <span class="coming-soon-badge">Coming Soon</span>
          </div>
        </div>
      </section>

      <!-- Goals & Strategy Section -->
      <section class="section {{ 'active' if sec == 'goals' }}" id="sec-goals">
        <!-- AI Strategy Recommendations -->
        <div class="ai-actions-card" id="goalRecsCard">
          <div class="ai-actions-header">
            <div class="ai-actions-title">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><circle cx="12" cy="12" r="6"/><circle cx="12" cy="12" r="2"/></svg>
              Strategy Recommendations
              <span class="ai-tag">AI-powered</span>
            </div>
          </div>
          <div class="ai-actions-body" id="goalRecsBody">
            <div class="ai-loading">Analyzing your goals...</div>
          </div>
        </div>

        <!-- Goal Progress Cards -->
        <div class="goals-grid" id="goalsGrid">
          <div class="ai-loading">Loading goals...</div>
        </div>

        <div class="grid-2 mt">
          <!-- Product Goals -->
          <div class="card">
            <div class="card-header"><h3>Product Sales Targets</h3></div>
            <div class="card-body">
              <table class="data-table" id="productGoalsTable">
                <thead><tr><th>Product</th><th>Category</th><th>Target</th><th>Sold</th><th>Progress</th></tr></thead>
                <tbody></tbody>
              </table>
            </div>
          </div>

          <!-- Goal History -->
          <div class="card">
            <div class="card-header"><h3>Goal History</h3></div>
            <div class="card-body">
              <table class="data-table" id="goalHistoryTable">
                <thead><tr><th>Period</th><th>Goal</th><th>Target</th><th>Achieved</th><th>Status</th></tr></thead>
                <tbody></tbody>
              </table>
            </div>
          </div>
        </div>

        <!-- Quarterly Strategy -->
        <div class="card mt">
          <div class="card-header"><h3>Quarterly Strategy</h3></div>
          <div class="card-body" id="strategyNotes">
            <div class="ai-loading">Loading strategy...</div>
          </div>
        </div>
      </section>

      <!-- Marketing Content Engine -->
      <section class="section {{ 'active' if sec == 'marketing' }}" id="sec-marketing">
        <div class="mke-tabs" id="mkeTabs">
          <button class="mke-tab active" data-tab="calendar">Content Calendar</button>
          <button class="mke-tab" data-tab="social">Social Posts</button>
          <button class="mke-tab" data-tab="emails">Email Campaigns</button>
          <button class="mke-tab" data-tab="promos">Promotions</button>
          <button class="mke-tab" data-tab="performance">Performance</button>
          <button class="mke-tab" data-tab="predictor">Predictor</button>
          <button class="mke-tab" data-tab="hashtags">Hashtags</button>
          <button class="mke-tab" data-tab="mke-report">Report</button>
          <button class="mke-tab" data-tab="email-builder">Email Builder</button>
          <button class="mke-tab" data-tab="weekly-digest">Weekly Digest</button>
        </div>

        <!-- Tab: Content Calendar -->
        <div class="mke-panel active" id="mkePanel-calendar">
          <div class="mke-panel-header">
            <div>
              <h3 class="mke-panel-title">Weekly Content Calendar</h3>
              <p class="mke-panel-sub">AI-generated content plan based on your sales data, trending products, and competitor weaknesses</p>
            </div>
            <div class="mke-panel-actions">
              <button class="mke-btn outline" id="mkeRegenCalendar">Regenerate</button>
              <button class="mke-btn primary" id="mkeScheduleAll">Add to Schedule</button>
            </div>
          </div>
          <div id="mkeCalendarGrid" class="mke-calendar-grid">
            <div class="ai-loading">Generating your content calendar...</div>
          </div>
        </div>

        <!-- Tab: Social Posts -->
        <div class="mke-panel" id="mkePanel-social">
          <div class="mke-panel-header">
            <div>
              <h3 class="mke-panel-title">Social Media Post Library</h3>
              <p class="mke-panel-sub">Ready-to-use posts based on your actual products and customer data</p>
            </div>
            <button class="mke-btn primary" id="mkeGenMore">Generate More</button>
          </div>
          <div class="mke-social-filters" id="mkeSocialFilters"></div>
          <div id="mkeSocialGrid" class="mke-social-grid">
            <div class="ai-loading">Loading social posts...</div>
          </div>
        </div>

        <!-- Tab: Email Campaigns -->
        <div class="mke-panel" id="mkePanel-emails">
          <div class="mke-panel-header">
            <div>
              <h3 class="mke-panel-title">Email Campaigns</h3>
              <p class="mke-panel-sub">Ready-to-send campaigns with personalization placeholders</p>
            </div>
          </div>
          <div id="mkeEmailList" class="mke-email-list">
            <div class="ai-loading">Building email campaigns...</div>
          </div>
        </div>

        <!-- Tab: Promotions -->
        <div class="mke-panel" id="mkePanel-promos">
          <div class="mke-panel-header">
            <div>
              <h3 class="mke-panel-title">Promotion Ideas</h3>
              <p class="mke-panel-sub">Data-driven promotions with full execution plans</p>
            </div>
          </div>
          <div id="mkePromoList" class="mke-promo-list">
            <div class="ai-loading">Crafting promotions...</div>
          </div>
        </div>

        <!-- Tab: Performance -->
        <div class="mke-panel" id="mkePanel-performance">
          <div class="mke-panel-header">
            <div>
              <h3 class="mke-panel-title">Marketing Performance</h3>
              <p class="mke-panel-sub">Track your marketing content usage and estimated impact</p>
            </div>
          </div>
          <div id="mkePerfContent">
            <div class="ai-loading">Loading performance data...</div>
          </div>
        </div>

        <!-- Tab: Content Predictor -->
        <div class="mke-panel" id="mkePanel-predictor">
          <div class="mke-panel-header">
            <div>
              <h3 class="mke-panel-title">Content Performance Predictor</h3>
              <p class="mke-panel-sub">Paste your post content and get an AI score with improvement suggestions</p>
            </div>
          </div>
          <div class="predictor-wrap">
            <div class="predictor-input-area">
              <textarea id="predictorInput" class="predictor-textarea" placeholder="Paste your social media post here... (e.g., 'Check out our new arrivals! #ShopLocal')"></textarea>
              <div class="predictor-controls">
                <select id="predictorPlatform">
                  <option value="instagram">Instagram</option>
                  <option value="facebook">Facebook</option>
                  <option value="twitter">Twitter/X</option>
                </select>
                <button class="mke-btn primary" id="predictorAnalyze">Analyze Post</button>
              </div>
            </div>
            <div class="predictor-results" id="predictorResults" hidden></div>
          </div>
        </div>

        <!-- Tab: Hashtag Generator -->
        <div class="mke-panel" id="mkePanel-hashtags">
          <div class="mke-panel-header">
            <div>
              <h3 class="mke-panel-title">Instagram Hashtag Generator</h3>
              <p class="mke-panel-sub">Optimized hashtags based on your shop, products, and location</p>
            </div>
          </div>
          <div class="hashtag-wrap">
            <div class="hashtag-topic-row">
              <input type="text" id="hashtagTopic" class="hashtag-input" placeholder="Optional: enter a topic (e.g., 'sale', 'new arrivals', 'VIP')">
              <button class="mke-btn primary" id="hashtagGenerate">Generate</button>
            </div>
            <div id="hashtagResults">
              <div class="ai-loading">Generating hashtags...</div>
            </div>
          </div>
        </div>

        <!-- Tab: Weekly Marketing Report -->
        <div class="mke-panel" id="mkePanel-mke-report">
          <div id="mkeWeeklyReport">
            <div class="ai-loading">Building your weekly report...</div>
          </div>
        </div>

        <!-- Tab: Email Template Builder -->
        <div class="mke-panel" id="mkePanel-email-builder">
          <div class="mke-panel-header">
            <div>
              <h3 class="mke-panel-title">Email Template Builder</h3>
              <p class="mke-panel-sub">Build custom email templates with your shop data pre-filled</p>
            </div>
          </div>
          <div class="email-builder-wrap">
            <div class="eb-controls">
              <select id="ebTemplateType">
                <option value="welcome">Welcome Email</option>
                <option value="flash_sale">Flash Sale Alert</option>
                <option value="event_invite">Event Invitation</option>
                <option value="product_launch">Product Launch</option>
                <option value="thank_you">Post-Purchase Thank You</option>
              </select>
              <input type="text" id="ebDiscount" class="eb-input" placeholder="Discount %" value="15">
              <button class="mke-btn primary" id="ebBuild">Build Template</button>
            </div>
            <div id="ebResult">
              <div class="ai-loading">Select a template type and click Build...</div>
            </div>
          </div>
        </div>

        <!-- Tab: Weekly Digest Preview -->
        <div class="mke-panel" id="mkePanel-weekly-digest">
          <div class="mke-panel-header">
            <div>
              <h3 class="mke-panel-title">Weekly Email Digest Preview</h3>
              <p class="mke-panel-sub">Preview the automated weekly performance email your customers or team will receive</p>
            </div>
          </div>
          <div class="digest-preview-wrap" id="digestPreviewWrap">
            <div class="ai-loading">Loading digest preview...</div>
          </div>
        </div>
      </section>

      <!-- Win-Back Campaigns Section -->
      <section class="section {{ 'active' if sec == 'winback' }}" id="sec-winback">
        <!-- Customer Status Overview -->
        <div class="wb-overview-grid" id="wbOverviewGrid">
          <div class="wb-metric-card">
            <div class="wb-metric-icon active-icon">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/></svg>
            </div>
            <div class="wb-metric-value" id="wbActive">--</div>
            <div class="wb-metric-label">Active Customers</div>
          </div>
          <div class="wb-metric-card">
            <div class="wb-metric-icon atrisk-icon">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"/><line x1="12" y1="9" x2="12" y2="13"/><line x1="12" y1="17" x2="12.01" y2="17"/></svg>
            </div>
            <div class="wb-metric-value" id="wbAtRisk">--</div>
            <div class="wb-metric-label">At-Risk</div>
          </div>
          <div class="wb-metric-card">
            <div class="wb-metric-icon lost-icon">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><line x1="15" y1="9" x2="9" y2="15"/><line x1="9" y1="9" x2="15" y2="15"/></svg>
            </div>
            <div class="wb-metric-value" id="wbLost">--</div>
            <div class="wb-metric-label">Lost</div>
          </div>
          <div class="wb-metric-card">
            <div class="wb-metric-icon wonback-icon">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="23 6 13.5 15.5 8.5 10.5 1 18"/><polyline points="17 6 23 6 23 12"/></svg>
            </div>
            <div class="wb-metric-value" id="wbWonBack">--</div>
            <div class="wb-metric-label">Won Back</div>
          </div>
        </div>

        <!-- Donut Chart -->
        <div class="card">
          <div class="card-header"><h3>Customer Health Distribution</h3></div>
          <div class="card-body" style="display:flex;align-items:center;justify-content:center;min-height:280px">
            <canvas id="wbDonutChart" style="max-width:320px;max-height:320px"></canvas>
          </div>
        </div>

        <!-- At-Risk Customers Table -->
        <div class="card mt">
          <div class="card-header">
            <h3>At-Risk Customers</h3>
            <div class="wb-table-actions">
              <select id="wbSortBy" class="wb-sort-select">
                <option value="days_since">Sort by: Days Since Visit</option>
                <option value="total_spent">Sort by: Lifetime Spend</option>
                <option value="visit_count">Sort by: Visit Count</option>
              </select>
            </div>
          </div>
          <div class="card-body wb-table-wrap">
            <table class="data-table" id="wbAtRiskTable">
              <thead>
                <tr>
                  <th><input type="checkbox" id="wbSelectAll"></th>
                  <th>Customer</th>
                  <th>Last Visit</th>
                  <th>Days Since</th>
                  <th>Lifetime Spend</th>
                  <th>Favorite Product</th>
                  <th>Visits</th>
                  <th>Action</th>
                </tr>
              </thead>
              <tbody></tbody>
            </table>
          </div>
        </div>

        <!-- Win-Back Campaign Templates -->
        <div class="card mt">
          <div class="card-header"><h3>Win-Back Campaign Templates</h3></div>
          <div class="card-body">
            <div class="wb-templates" id="wbTemplates">
              <div class="ai-loading">Loading templates...</div>
            </div>
          </div>
        </div>

        <!-- Campaign History -->
        <div class="card mt">
          <div class="card-header"><h3>Campaign History</h3></div>
          <div class="card-body">
            <table class="data-table" id="wbHistoryTable">
              <thead><tr><th>Campaign</th><th>Template</th><th>Customers</th><th>Discount</th><th>Status</th><th>Open Rate</th><th>Recovery</th><th>Date</th></tr></thead>
              <tbody></tbody>
            </table>
          </div>
        </div>

        <!-- Automation Settings -->
        <div class="card mt">
          <div class="card-header"><h3>Automation Settings</h3></div>
          <div class="card-body">
            <div class="wb-automation" id="wbAutomation">
              <div class="ai-loading">Loading settings...</div>
            </div>
          </div>
        </div>
      </section>

      <!-- Reviews Section -->
      <section class="section {{ 'active' if sec == 'reviews' }}" id="sec-reviews">
        <div class="kpi-grid small">
          <div class="kpi-card"><div class="kpi-label">Avg Rating</div><div class="kpi-value" id="revAvg">--</div></div>
          <div class="kpi-card"><div class="kpi-label">Total Reviews</div><div class="kpi-value" id="revTotal">--</div></div>
          <div class="kpi-card"><div class="kpi-label">Positive</div><div class="kpi-value" id="revPos">--</div></div>
          <div class="kpi-card"><div class="kpi-label">Negative</div><div class="kpi-value" id="revNeg">--</div></div>
        </div>
        <div class="card mt">
          <div class="card-header"><h3>Review Feed</h3></div>
          <div class="card-body">
            <div class="review-list" id="reviewList"></div>
          </div>
        </div>
      </section>

      <!-- Alerts Section -->
      <section class="section {{ 'active' if sec == 'alerts' }}" id="sec-alerts">
        <div class="card">
          <div class="card-header"><h3>All Alerts</h3></div>
          <div class="card-body">
            <div class="alert-list full" id="alertListFull"></div>
          </div>
        </div>
      </section>

      <!-- Settings Section -->
      <section class="section {{ 'active' if sec == 'settings' }}" id="sec-settings">
        <div class="settings-page">
          <div class="settings-group">
            <h3 class="settings-group-title">Shop Information</h3>
            <div class="settings-grid">
              <div class="settings-field">
                <label class="settings-label">Shop Name</label>
                <input type="text" class="settings-input" id="setShopName" placeholder="Your shop name">
              </div>
              <div class="settings-field">
                <label class="settings-label">Address</label>
                <input type="text" class="settings-input" id="setAddress" placeholder="Shop address">
              </div>
              <div class="settings-field">
                <label class="settings-label">Category</label>
                <select class="settings-input" id="setCategory">
                  <option value="retail">Retail</option>
                  <option value="restaurant">Restaurant</option>
                  <option value="cafe">Cafe</option>
                  <option value="boutique">Boutique</option>
                  <option value="grocery">Grocery</option>
                  <option value="salon">Salon</option>
                  <option value="other">Other</option>
                </select>
              </div>
              <div class="settings-field">
                <label class="settings-label">Store Size (sq ft)</label>
                <input type="number" class="settings-input" id="setStoreSize" placeholder="e.g. 1200">
              </div>
              <div class="settings-field">
                <label class="settings-label">Staff Count</label>
                <input type="number" class="settings-input" id="setStaffCount" placeholder="e.g. 5">
              </div>
            </div>
          </div>
          <div class="settings-group">
            <h3 class="settings-group-title">Financial Settings</h3>
            <div class="settings-grid">
              <div class="settings-field">
                <label class="settings-label">Monthly Rent ($)</label>
                <input type="number" class="settings-input" id="setRent" placeholder="e.g. 3000" step="0.01">
              </div>
              <div class="settings-field">
                <label class="settings-label">Avg COGS %</label>
                <input type="number" class="settings-input" id="setCogs" placeholder="e.g. 40" step="0.1">
              </div>
              <div class="settings-field">
                <label class="settings-label">Staff Hourly Rate ($)</label>
                <input type="number" class="settings-input" id="setHourlyRate" placeholder="e.g. 15" step="0.01">
              </div>
              <div class="settings-field">
                <label class="settings-label">Tax Rate (%)</label>
                <input type="number" class="settings-input" id="setTaxRate" placeholder="e.g. 8.25" step="0.01">
              </div>
            </div>
          </div>
          <div class="settings-group">
            <h3 class="settings-group-title">Integrations</h3>
            <div class="settings-grid">
              <div class="settings-field" style="grid-column:1/-1">
                <label class="settings-label">Google Places API Key</label>
                <input type="password" class="settings-input" id="setGoogleApiKey" placeholder="Enter your Google Places API key (optional — mock data used if blank)">
                <small style="color:var(--text-secondary);margin-top:4px;display:block">Used for business search, competitor discovery, and review syncing. Get a key at <a href="https://console.cloud.google.com" target="_blank" style="color:var(--accent)">Google Cloud Console</a>.</small>
              </div>
            </div>
          </div>
          <div class="settings-group">
            <h3 class="settings-group-title">Notifications & Alerts</h3>
            <div class="settings-grid">
              <div class="settings-field">
                <label class="settings-label">Email Digest Frequency</label>
                <select class="settings-input" id="setEmailFreq">
                  <option value="daily">Daily</option>
                  <option value="weekly">Weekly</option>
                  <option value="monthly">Monthly</option>
                  <option value="never">Never</option>
                </select>
              </div>
            </div>
            <div class="settings-toggles">
              <label class="settings-toggle"><input type="checkbox" id="setAlertRevenue" checked><span>Revenue alerts</span></label>
              <label class="settings-toggle"><input type="checkbox" id="setAlertCustomers" checked><span>Customer alerts</span></label>
              <label class="settings-toggle"><input type="checkbox" id="setAlertReviews" checked><span>Review alerts</span></label>
              <label class="settings-toggle"><input type="checkbox" id="setAlertCompetitors" checked><span>Competitor alerts</span></label>
            </div>
          </div>
          <div class="settings-actions">
            <button class="btn-primary" id="saveSettingsBtn">Save Settings</button>
            <span class="settings-saved-msg" id="settingsSavedMsg" hidden>Settings saved!</span>
          </div>
        </div>
      </section>
    </div>
  </main>

  <!-- Help Tooltip Button -->
  <button class="help-tooltip-btn" id="helpTooltipBtn" title="Toggle help tooltips">?</button>

  <!-- Mobile sidebar overlay -->
  <div class="sidebar-overlay" id="sidebarOverlay"></div>

  <!-- Keyboard Shortcuts Modal -->
  <div class="modal-overlay" id="shortcutsModal">
    <div class="shortcuts-modal">
      <div class="shortcuts-header">
        <h2>Keyboard Shortcuts</h2>
        <button class="shortcuts-close" id="shortcutsClose">&times;</button>
      </div>
      <div class="shortcuts-body">
        <div class="shortcut-row"><kbd>B</kbd><span>Daily Briefing</span></div>
        <div class="shortcut-row"><kbd>D</kbd><span>Data Hub</span></div>
        <div class="shortcut-row"><kbd>O</kbd><span>Overview</span></div>
        <div class="shortcut-row"><kbd>S</kbd><span>Sales</span></div>
        <div class="shortcut-row"><kbd>P</kbd><span>Products</span></div>
        <div class="shortcut-row"><kbd>U</kbd><span>Customers</span></div>
        <div class="shortcut-row"><kbd>C</kbd><span>Competitors</span></div>
        <div class="shortcut-row"><kbd>G</kbd><span>Goals</span></div>
        <div class="shortcut-row"><kbd>M</kbd><span>Marketing</span></div>
        <div class="shortcut-row"><kbd>W</kbd><span>Win-Back</span></div>
        <div class="shortcut-row"><kbd>/</kbd><span>Focus search</span></div>
        <div class="shortcut-row"><kbd>?</kbd><span>Show this help</span></div>
        <div class="shortcut-row"><kbd>Esc</kbd><span>Close modals</span></div>
      </div>
    </div>
  </div>

  <script>
    window.__ACTIVE_SECTION = "{{ active_section|default('overview') }}";
    window.__SUB_SECTION = "{{ sub_section|default('') }}";
    window.__WELCOME = "{{ welcome|default('') }}";
  </script>
  <script src="/static/dashboard.js?v=20"></script>

  <!-- Notification Bell — Inline JS (simplest possible approach) -->
  <script>
    function toggleNotifications(e) {
      e.stopPropagation();
      var dropdown = document.getElementById('notifDropdown');
      if (dropdown.classList.contains('show')) {
        dropdown.classList.remove('show');
      } else {
        dropdown.classList.add('show');
        loadNotifications();
      }
    }

    function loadNotifications() {
      var body = document.getElementById('notifDropdownBody');
      fetch('/api/dashboard/notifications', {credentials: 'same-origin'})
        .then(function(res) { return res.json(); })
        .then(function(data) {
          if (!data || !data.notifications || data.notifications.length === 0) {
            body.innerHTML = '<div style="padding:20px;text-align:center;color:var(--text3);font-size:13px">No notifications</div>';
            return;
          }
          var badge = document.getElementById('notifBadge');
          if (data.unread_count > 0) {
            badge.textContent = data.unread_count;
            badge.hidden = false;
          } else {
            badge.hidden = true;
          }
          body.innerHTML = data.notifications.map(function(a) {
            return '<div class="notif-item' + (a.is_read ? '' : ' unread') + '" style="padding:10px 14px;border-bottom:1px solid var(--border);font-size:13px;cursor:pointer">' +
              '<div style="font-weight:' + (a.is_read ? '400' : '600') + '">' + (a.severity_icon || '') + ' ' + (a.title || a.message || 'Alert') + '</div>' +
              '<div style="font-size:11px;color:var(--text3);margin-top:2px">' + (a.icon || '') + ' ' + (a.category || 'general') + ' &middot; ' + (a.time_ago || '') + '</div>' +
            '</div>';
          }).join('');
        })
        .catch(function() {
          body.innerHTML = '<div style="padding:20px;text-align:center;color:var(--text3)">Failed to load</div>';
        });
    }

    function markAllNotificationsRead(e) {
      e.stopPropagation();
      fetch('/api/dashboard/notifications/read-all', {method: 'POST', credentials: 'same-origin'})
        .then(function() {
          var badge = document.getElementById('notifBadge');
          badge.hidden = true;
          badge.textContent = '0';
          document.querySelectorAll('.notif-item.unread').forEach(function(el) { el.classList.remove('unread'); el.querySelector('div').style.fontWeight = '400'; });
        });
    }

    function goToAlerts(e) {
      e.preventDefault();
      e.stopPropagation();
      document.getElementById('notifDropdown').classList.remove('show');
      var alertNav = document.querySelector('.nav-item[data-section="alerts"]');
      if (alertNav) alertNav.click();
    }

    // Close dropdown when clicking outside
    document.addEventListener('click', function(e) {
      var wrap = document.getElementById('notifBellWrap');
      var dropdown = document.getElementById('notifDropdown');
      if (wrap && dropdown && !wrap.contains(e.target)) {
        dropdown.classList.remove('show');
      }
    });

    // Load notification badge count on page load
    (function() {
      fetch('/api/dashboard/notifications', {credentials: 'same-origin'})
        .then(function(res) { return res.json(); })
        .then(function(data) {
          if (data && data.unread_count > 0) {
            var badge = document.getElementById('notifBadge');
            var alertBadge = document.getElementById('alertBadge');
            if (badge) { badge.textContent = data.unread_count; badge.hidden = false; }
            if (alertBadge) { alertBadge.textContent = data.unread_count; alertBadge.hidden = false; }
          }
        })
        .catch(function() {});
    })();
  </script>
</body>
</html>
