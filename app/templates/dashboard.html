<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dashboard — RetailIQ</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.7/dist/chart.umd.min.js"></script>
  <link rel="stylesheet" href="/static/dashboard.css?v=13">
</head>
<body>
  <!-- Sidebar -->
  <aside class="sidebar" id="sidebar">
    <div class="sidebar-header">
      <a href="/" class="logo">
        <svg width="28" height="28" viewBox="0 0 32 32" fill="none">
          <rect width="32" height="32" rx="8" fill="url(#lg)"/>
          <path d="M9 22V12l4 4 4-6 4 8v4" stroke="#fff" stroke-width="2.2" stroke-linecap="round" stroke-linejoin="round"/>
          <defs><linearGradient id="lg" x1="0" y1="0" x2="32" y2="32"><stop stop-color="#6366f1"/><stop offset="1" stop-color="#06b6d4"/></linearGradient></defs>
        </svg>
        <span>RetailIQ</span>
      </a>
    </div>
    <nav class="sidebar-nav">
      {% set sec = active_section|default('overview') %}
      <a href="/dashboard/briefing" class="nav-item {{ 'active' if sec == 'briefing' }}" data-section="briefing">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 8h1a4 4 0 0 1 0 8h-1"/><path d="M2 8h16v9a4 4 0 0 1-4 4H6a4 4 0 0 1-4-4V8z"/><line x1="6" y1="1" x2="6" y2="4"/><line x1="10" y1="1" x2="10" y2="4"/><line x1="14" y1="1" x2="14" y2="4"/></svg>
        Daily Briefing
      </a>
      <a href="/dashboard" class="nav-item {{ 'active' if sec == 'overview' }}" data-section="overview">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="7" height="7"/><rect x="14" y="3" width="7" height="7"/><rect x="14" y="14" width="7" height="7"/><rect x="3" y="14" width="7" height="7"/></svg>
        Overview
      </a>
      <a href="/dashboard/sales" class="nav-item {{ 'active' if sec == 'sales' }}" data-section="sales">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="1" x2="12" y2="23"/><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/></svg>
        Sales
      </a>
      <a href="/dashboard/products" class="nav-item {{ 'active' if sec == 'products' }}" data-section="products">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M6 2L3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4z"/><line x1="3" y1="6" x2="21" y2="6"/><path d="M16 10a4 4 0 0 1-8 0"/></svg>
        Products
      </a>
      <a href="/dashboard/customers" class="nav-item {{ 'active' if sec == 'customers' }}" data-section="customers">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>
        Customers
      </a>
      <a href="/dashboard/competitors" class="nav-item {{ 'active' if sec == 'competitors' }}" data-section="competitors">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg>
        Competitors
      </a>
      <a href="/dashboard/goals" class="nav-item {{ 'active' if sec == 'goals' }}" data-section="goals">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><circle cx="12" cy="12" r="6"/><circle cx="12" cy="12" r="2"/></svg>
        Goals
      </a>
      <a href="/dashboard/marketing" class="nav-item {{ 'active' if sec == 'marketing' }}" data-section="marketing">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 15s1-1 4-1 5 2 8 2 4-1 4-1V3s-1 1-4 1-5-2-8-2-4 1-4 1z"/><line x1="4" y1="22" x2="4" y2="15"/></svg>
        Marketing
      </a>
      <a href="/dashboard/win-back" class="nav-item {{ 'active' if sec == 'winback' }}" data-section="winback">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"/></svg>
        Win-Back
      </a>
      <a href="/dashboard/reviews" class="nav-item {{ 'active' if sec == 'reviews' }}" data-section="reviews">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/></svg>
        Reviews
      </a>
      <a href="/dashboard/alerts" class="nav-item {{ 'active' if sec == 'alerts' }}" data-section="alerts">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"/><path d="M13.73 21a2 2 0 0 1-3.46 0"/></svg>
        Alerts
        <span class="badge" id="alertBadge" hidden>0</span>
      </a>
    </nav>
    <div class="sidebar-footer">
      <a href="/dashboard/upgrade" class="sidebar-upgrade-link">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></svg>
        Upgrade Plan
      </a>
      <div class="sidebar-user-row">
        <div class="user-info">
          <div class="user-avatar">{{ user.full_name[:2]|upper }}</div>
          <div>
            <div class="user-name">{{ user.full_name }}</div>
            <div class="user-plan">{{ user.plan_tier|capitalize }} Plan</div>
          </div>
        </div>
        <button class="logout-btn" id="logoutBtn" title="Logout">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/><polyline points="16 17 21 12 16 7"/><line x1="21" y1="12" x2="9" y2="12"/></svg>
        </button>
      </div>
    </div>
  </aside>

  <!-- Main Content -->
  <main class="main">
    <header class="topbar">
      <button class="mobile-toggle" id="mobileToggle">
        <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="18" x2="21" y2="18"/></svg>
      </button>
      <div class="topbar-left">
        <div class="breadcrumb" id="breadcrumb">
          <span>Dashboard</span>
          <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><polyline points="9 18 15 12 9 6"/></svg>
          <span id="breadcrumbPage">Overview</span>
        </div>
        <h1 id="pageTitle">Overview</h1>
      </div>
      <div class="topbar-center">
        <div class="search-wrap" id="searchWrap">
          <svg class="search-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg>
          <input type="text" id="searchInput" class="search-input" placeholder="Search products, customers... (press /)" autocomplete="off">
          <kbd class="search-kbd">/</kbd>
          <div class="search-results" id="searchResults" hidden></div>
        </div>
      </div>
      <div class="topbar-right">
        <span class="last-updated" id="lastUpdated" title="Last data refresh">Updated just now</span>
        <span class="refresh-indicator" id="refreshIndicator" title="Auto-refreshes every 60s">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="23 4 23 10 17 10"/><path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10"/></svg>
        </span>
        <div class="notif-bell-wrap" id="notifBellWrap">
          <button class="notif-bell-btn" id="notifBellBtn" title="Notifications">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"/><path d="M13.73 21a2 2 0 0 1-3.46 0"/></svg>
            <span class="notif-badge" id="notifBadge" hidden>0</span>
          </button>
          <div class="notif-dropdown" id="notifDropdown">
            <div class="notif-dropdown-header">
              <span class="notif-dropdown-title">Notifications</span>
              <button class="notif-mark-all" id="notifMarkAll">Mark All Read</button>
            </div>
            <div class="notif-dropdown-body" id="notifDropdownBody">
              <div class="ai-loading">Loading...</div>
            </div>
            <div class="notif-dropdown-footer">
              <a href="#" id="notifViewAll">View All Alerts</a>
            </div>
          </div>
        </div>
        <button class="theme-toggle" id="themeToggle" title="Toggle theme">
          <svg class="icon-sun" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg>
          <svg class="icon-moon" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1 1 11.21 3a7 7 0 0 0 9.79 9.79z"/></svg>
        </button>
      </div>
    </header>

    {% if show_trial_banner %}
    <div class="trial-banner" id="trialBanner">
      <div class="trial-banner-left">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>
        <span>Free Trial: <strong>{{ trial_days }} day{{ 's' if trial_days != 1 else '' }}</strong> remaining</span>
      </div>
      <a href="/dashboard/upgrade" class="trial-banner-btn">Upgrade Now</a>
    </div>
    {% endif %}

    {% if welcome %}
    <div class="welcome-banner" id="welcomeBanner">
      <div class="welcome-banner-content">
        <div class="welcome-emoji">&#127881;</div>
        <div>
          <div class="welcome-title">Welcome to RetailIQ!</div>
          <div class="welcome-sub">Your dashboard is ready with 30 days of starter data. Explore your analytics below.</div>
        </div>
      </div>
      <button class="welcome-dismiss" id="welcomeDismiss">&times;</button>
    </div>
    {% endif %}

    <!-- Quick Stats Bar -->
    <div class="quick-stats-bar" id="quickStatsBar">
      <div class="quick-stat-item">
        <span class="quick-stat-icon">&#128202;</span>
        <span>Today: <strong id="qsRevenue">--</strong></span>
      </div>
      <div class="quick-stat-item">
        <span class="quick-stat-icon">&#128230;</span>
        <span><strong id="qsTransactions">--</strong> transactions</span>
      </div>
      <div class="quick-stat-item">
        <span class="quick-stat-icon">&#128101;</span>
        <span><strong id="qsCustomers">--</strong> customers</span>
      </div>
      <div class="quick-stat-item">
        <span class="quick-stat-icon">&#11088;</span>
        <span><strong id="qsRating">--</strong> rating</span>
      </div>
    </div>

    <div class="content" id="content">
      <!-- Daily Briefing Section -->
      <section class="section {{ 'active' if sec == 'briefing' }}" id="sec-briefing">
        <div class="briefing-hero" id="briefingHero">
          <div class="briefing-greeting" id="briefingGreeting">Good morning!</div>
          <div class="briefing-date" id="briefingDate"></div>
        </div>

        <!-- Numbers Today -->
        <div class="briefing-section">
          <h3 class="briefing-section-title">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="1" x2="12" y2="23"/><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/></svg>
            Your Numbers Today
          </h3>
          <div class="briefing-numbers" id="briefingNumbers">
            <div class="briefing-num-card">
              <div class="briefing-num-label">Yesterday's Revenue</div>
              <div class="briefing-num-value" id="brfRevenue">--</div>
              <div class="briefing-num-change" id="brfRevChange">--</div>
            </div>
            <div class="briefing-num-card">
              <div class="briefing-num-label">Transactions</div>
              <div class="briefing-num-value" id="brfTransactions">--</div>
              <div class="briefing-num-change" id="brfTxnChange">--</div>
            </div>
            <div class="briefing-num-card">
              <div class="briefing-num-label">Avg Order Value</div>
              <div class="briefing-num-value" id="brfAov">--</div>
              <div class="briefing-num-sub">per transaction</div>
            </div>
            <div class="briefing-num-card goal-card-brief">
              <div class="briefing-num-label">Monthly Goal</div>
              <div class="briefing-num-value" id="brfGoalPct">--</div>
              <div class="briefing-goal-bar"><div class="briefing-goal-fill" id="brfGoalFill"></div></div>
              <div class="briefing-num-sub" id="brfGoalSub">--</div>
            </div>
          </div>
        </div>

        <!-- Top 3 Things To Do -->
        <div class="briefing-section">
          <h3 class="briefing-section-title">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="9 11 12 14 22 4"/><path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"/></svg>
            Top 3 Things To Do Today
          </h3>
          <div class="briefing-todos" id="briefingTodos">
            <div class="ai-loading">Analyzing your data...</div>
          </div>
        </div>

        <div class="briefing-grid-2">
          <!-- Competitor Watch -->
          <div class="briefing-section">
            <h3 class="briefing-section-title">
              <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg>
              Competitor Watch
            </h3>
            <div class="briefing-comp-list" id="briefingCompWatch">
              <div class="ai-loading">Loading...</div>
            </div>
          </div>

          <!-- Customer Pulse -->
          <div class="briefing-section">
            <h3 class="briefing-section-title">
              <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>
              Customer Pulse
            </h3>
            <div class="briefing-pulse" id="briefingPulse">
              <div class="ai-loading">Loading...</div>
            </div>
          </div>
        </div>

        <!-- This Week's Marketing -->
        <div class="briefing-section">
          <h3 class="briefing-section-title">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 15s1-1 4-1 5 2 8 2 4-1 4-1V3s-1 1-4 1-5-2-8-2-4 1-4 1z"/><line x1="4" y1="22" x2="4" y2="15"/></svg>
            Today's Marketing Tip
          </h3>
          <div class="briefing-marketing" id="briefingMarketing">
            <div class="ai-loading">Loading...</div>
          </div>
        </div>
      </section>

      <!-- Overview Section -->
      <section class="section {{ 'active' if sec == 'overview' }}" id="sec-overview">
        <!-- Insights Strip -->
        <div class="insight-strip" id="insightStrip"></div>

        <!-- AI Action Items -->
        <div class="ai-actions-card" id="aiActionsCard">
          <div class="ai-actions-header">
            <div class="ai-actions-title">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></svg>
              AI Action Items
              <span class="ai-tag">Updated daily</span>
            </div>
          </div>
          <div class="ai-actions-body" id="aiActionsBody">
            <div class="ai-loading">Analyzing your data...</div>
          </div>
        </div>

        <div class="kpi-grid" id="kpiGrid">
          <div class="kpi-card" data-tooltip="Total revenue earned today (or latest data date)">
            <div class="kpi-label">Revenue Today</div>
            <div class="kpi-value" id="kpiRevenue">--</div>
            <div class="kpi-change" id="kpiRevenueDod">--</div>
          </div>
          <div class="kpi-card" data-tooltip="Number of completed sales transactions today">
            <div class="kpi-label">Transactions</div>
            <div class="kpi-value" id="kpiTransactions">--</div>
            <div class="kpi-sub">today</div>
          </div>
          <div class="kpi-card" data-tooltip="Average revenue per transaction (revenue / transactions)">
            <div class="kpi-label">Avg Order Value</div>
            <div class="kpi-value" id="kpiAov">--</div>
            <div class="kpi-sub">per transaction</div>
          </div>
          <div class="kpi-card" data-tooltip="Percentage of customers who have visited more than once">
            <div class="kpi-label">Repeat Customers</div>
            <div class="kpi-value" id="kpiRepeat">--</div>
            <div class="kpi-sub">return rate</div>
          </div>
        </div>

        <div class="chart-row">
          <div class="card chart-card wide">
            <div class="card-header">
              <h3>Revenue — Last 30 Days</h3>
            </div>
            <div class="card-body">
              <canvas id="revenueChart"></canvas>
            </div>
          </div>
          <div class="card chart-card">
            <div class="card-header">
              <h3>Peak Hours</h3>
            </div>
            <div class="card-body">
              <div class="heatmap-container" id="heatmap"></div>
            </div>
          </div>
        </div>

        <div class="chart-row">
          <div class="card">
            <div class="card-header"><h3>Top Products</h3></div>
            <div class="card-body">
              <table class="data-table" id="productsTableOverview">
                <thead><tr><th>Product</th><th>Revenue</th><th>Units</th></tr></thead>
                <tbody></tbody>
              </table>
            </div>
          </div>
          <div class="card">
            <div class="card-header"><h3>Recent Alerts</h3></div>
            <div class="card-body">
              <div class="alert-list" id="alertListOverview"></div>
            </div>
          </div>
        </div>
      </section>

      <!-- Sales Section -->
      <section class="section {{ 'active' if sec == 'sales' }}" id="sec-sales">
        <div class="section-toolbar">
          <button class="export-btn" onclick="exportCSV('sales')">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>
            Export CSV
          </button>
        </div>
        <div class="card">
          <div class="card-header"><h3>Sales Trend</h3></div>
          <div class="card-body"><canvas id="salesChartFull"></canvas></div>
        </div>
        <div class="grid-2 mt">
          <div class="card">
            <div class="card-header"><h3>Weekly Summary</h3></div>
            <div class="card-body"><table class="data-table" id="weeklyTable"><thead><tr><th>Week</th><th>Revenue</th><th>Transactions</th></tr></thead><tbody></tbody></table></div>
          </div>
          <div class="card">
            <div class="card-header"><h3>Monthly Summary</h3></div>
            <div class="card-body"><table class="data-table" id="monthlyTable"><thead><tr><th>Month</th><th>Revenue</th><th>Transactions</th></tr></thead><tbody></tbody></table></div>
          </div>
        </div>
      </section>

      <!-- Products Section -->
      <section class="section {{ 'active' if sec == 'products' }}" id="sec-products">
        <div class="section-toolbar">
          <button class="export-btn" onclick="exportCSV('products')">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>
            Export CSV
          </button>
        </div>
        <div class="card">
          <div class="card-header"><h3>Product Performance Rankings</h3></div>
          <div class="card-body">
            <table class="data-table" id="productsTableFull">
              <thead><tr><th>#</th><th>Product</th><th>Category</th><th>Revenue</th><th>Units Sold</th><th>Avg Price</th><th>Margin</th></tr></thead>
              <tbody></tbody>
            </table>
          </div>
        </div>
      </section>

      <!-- Customers Section -->
      <section class="section {{ 'active' if sec == 'customers' }}" id="sec-customers">
        <div class="section-toolbar">
          <button class="export-btn" onclick="exportCSV('customers')">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>
            Export CSV
          </button>
        </div>
        <div class="kpi-grid small">
          <div class="kpi-card"><div class="kpi-label">Total Customers</div><div class="kpi-value" id="custTotal">--</div></div>
          <div class="kpi-card"><div class="kpi-label">Repeat Rate</div><div class="kpi-value" id="custRepeat">--</div></div>
          <div class="kpi-card"><div class="kpi-label">New (30d)</div><div class="kpi-value" id="custNew">--</div></div>
          <div class="kpi-card"><div class="kpi-label">Avg Revenue/Customer</div><div class="kpi-value" id="custAvgRev">--</div></div>
        </div>
        <div class="card mt">
          <div class="card-header"><h3>Top Customers by Spend</h3></div>
          <div class="card-body">
            <table class="data-table" id="topCustomersTable">
              <thead><tr><th>#</th><th>Customer</th><th>Visits</th><th>Total Spent</th><th>Last Seen</th></tr></thead>
              <tbody></tbody>
            </table>
          </div>
        </div>
      </section>

      <!-- Competitors Section (Full Intelligence Dashboard) -->
      <section class="section {{ 'active' if sec == 'competitors' }}" id="sec-competitors">
        <!-- Sub-navigation tabs -->
        <div class="comp-tabs" id="compTabs">
          <button class="comp-tab active" data-tab="overview">Overview</button>
          <button class="comp-tab" data-tab="comparison">Comparison</button>
          <button class="comp-tab" data-tab="opportunities">Opportunities</button>
          <button class="comp-tab" data-tab="review-feed">Review Feed</button>
          <button class="comp-tab" data-tab="sentiment">Sentiment</button>
          <button class="comp-tab" data-tab="market-map">Market Map</button>
          <button class="comp-tab" data-tab="weekly-report">Weekly Report</button>
          <button class="comp-tab" data-tab="trend-alerts">Trend Alerts</button>
          <button class="comp-tab" data-tab="response-analysis">Response</button>
          <button class="comp-tab" data-tab="advantages">Advantages</button>
          <button class="comp-tab" data-tab="marketing">Marketing</button>
        </div>

        <!-- Tab: Overview -->
        <div class="comp-panel active" id="compPanel-overview">
          <div class="comp-cards-grid" id="compCardsGrid">
            <div class="ai-loading">Loading competitor data...</div>
          </div>
        </div>

        <!-- Tab: Comparison -->
        <div class="comp-panel" id="compPanel-comparison">
          <div class="card">
            <div class="card-header"><h3>Side-by-Side Competitor Comparison</h3></div>
            <div class="card-body comp-table-wrap">
              <table class="data-table comp-comparison-table" id="compComparisonTable">
                <thead><tr><th>Business</th><th>Rating</th><th>Reviews</th><th>Response Rate</th><th>Sentiment</th><th>Est. Traffic</th><th>Strengths</th><th>Weaknesses</th></tr></thead>
                <tbody></tbody>
              </table>
            </div>
          </div>
        </div>

        <!-- Tab: Opportunities -->
        <div class="comp-panel" id="compPanel-opportunities">
          <div class="opp-list" id="oppList">
            <div class="ai-loading">Detecting opportunities...</div>
          </div>
        </div>

        <!-- Tab: Review Feed -->
        <div class="comp-panel" id="compPanel-review-feed">
          <div class="comp-filters" id="compFilters">
            <select id="filterCompetitor"><option value="">All Competitors</option></select>
            <select id="filterRating"><option value="">All Ratings</option><option value="1">1 Star</option><option value="2">2 Stars</option><option value="3">3 Stars</option><option value="4">4 Stars</option><option value="5">5 Stars</option></select>
            <select id="filterSentiment"><option value="">All Sentiments</option><option value="positive">Positive</option><option value="neutral">Neutral</option><option value="negative">Negative</option></select>
          </div>
          <div class="review-list" id="compReviewFeed"></div>
        </div>

        <!-- Tab: Sentiment -->
        <div class="comp-panel" id="compPanel-sentiment">
          <div class="sentiment-grid" id="sentimentGrid"></div>
        </div>

        <!-- Tab: Market Map -->
        <div class="comp-panel" id="compPanel-market-map">
          <div class="card">
            <div class="card-header"><h3>Market Position Map</h3><span class="card-sub">X: Review Volume | Y: Rating</span></div>
            <div class="card-body">
              <div class="market-map-container">
                <canvas id="marketMapChart"></canvas>
              </div>
            </div>
          </div>
        </div>

        <!-- Tab: Weekly Report -->
        <div class="comp-panel" id="compPanel-weekly-report">
          <div class="weekly-report" id="weeklyReport"></div>
        </div>

        <!-- Tab: Trend Alerts -->
        <div class="comp-panel" id="compPanel-trend-alerts">
          <div class="trend-alerts-list" id="trendAlertsList">
            <div class="ai-loading">Scanning for trend changes...</div>
          </div>
        </div>

        <!-- Tab: Response Analysis -->
        <div class="comp-panel" id="compPanel-response-analysis">
          <div class="response-analysis" id="responseAnalysis">
            <div class="ai-loading">Analyzing response rates...</div>
          </div>
        </div>

        <!-- Tab: Competitive Advantages -->
        <div class="comp-panel" id="compPanel-advantages">
          <div class="advantages-dashboard" id="advantagesDashboard">
            <div class="ai-loading">Finding your competitive edges...</div>
          </div>
        </div>

        <!-- Tab: Marketing Responses -->
        <div class="comp-panel" id="compPanel-marketing">
          <div class="marketing-filters">
            <button class="mkt-filter-btn active" data-status="">All</button>
            <button class="mkt-filter-btn" data-status="new">New</button>
            <button class="mkt-filter-btn" data-status="saved">Saved</button>
            <button class="mkt-filter-btn" data-status="used">Used</button>
          </div>
          <div class="marketing-list" id="marketingList"></div>
        </div>
      </section>

      <!-- Goals & Strategy Section -->
      <section class="section {{ 'active' if sec == 'goals' }}" id="sec-goals">
        <!-- AI Strategy Recommendations -->
        <div class="ai-actions-card" id="goalRecsCard">
          <div class="ai-actions-header">
            <div class="ai-actions-title">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><circle cx="12" cy="12" r="6"/><circle cx="12" cy="12" r="2"/></svg>
              Strategy Recommendations
              <span class="ai-tag">AI-powered</span>
            </div>
          </div>
          <div class="ai-actions-body" id="goalRecsBody">
            <div class="ai-loading">Analyzing your goals...</div>
          </div>
        </div>

        <!-- Goal Progress Cards -->
        <div class="goals-grid" id="goalsGrid">
          <div class="ai-loading">Loading goals...</div>
        </div>

        <div class="grid-2 mt">
          <!-- Product Goals -->
          <div class="card">
            <div class="card-header"><h3>Product Sales Targets</h3></div>
            <div class="card-body">
              <table class="data-table" id="productGoalsTable">
                <thead><tr><th>Product</th><th>Category</th><th>Target</th><th>Sold</th><th>Progress</th></tr></thead>
                <tbody></tbody>
              </table>
            </div>
          </div>

          <!-- Goal History -->
          <div class="card">
            <div class="card-header"><h3>Goal History</h3></div>
            <div class="card-body">
              <table class="data-table" id="goalHistoryTable">
                <thead><tr><th>Period</th><th>Goal</th><th>Target</th><th>Achieved</th><th>Status</th></tr></thead>
                <tbody></tbody>
              </table>
            </div>
          </div>
        </div>

        <!-- Quarterly Strategy -->
        <div class="card mt">
          <div class="card-header"><h3>Quarterly Strategy</h3></div>
          <div class="card-body" id="strategyNotes">
            <div class="ai-loading">Loading strategy...</div>
          </div>
        </div>
      </section>

      <!-- Marketing Content Engine -->
      <section class="section {{ 'active' if sec == 'marketing' }}" id="sec-marketing">
        <div class="mke-tabs" id="mkeTabs">
          <button class="mke-tab active" data-tab="calendar">Content Calendar</button>
          <button class="mke-tab" data-tab="social">Social Posts</button>
          <button class="mke-tab" data-tab="emails">Email Campaigns</button>
          <button class="mke-tab" data-tab="promos">Promotions</button>
          <button class="mke-tab" data-tab="performance">Performance</button>
        </div>

        <!-- Tab: Content Calendar -->
        <div class="mke-panel active" id="mkePanel-calendar">
          <div class="mke-panel-header">
            <div>
              <h3 class="mke-panel-title">Weekly Content Calendar</h3>
              <p class="mke-panel-sub">AI-generated content plan based on your sales data, trending products, and competitor weaknesses</p>
            </div>
            <div class="mke-panel-actions">
              <button class="mke-btn outline" id="mkeRegenCalendar">Regenerate</button>
              <button class="mke-btn primary" id="mkeScheduleAll">Add to Schedule</button>
            </div>
          </div>
          <div id="mkeCalendarGrid" class="mke-calendar-grid">
            <div class="ai-loading">Generating your content calendar...</div>
          </div>
        </div>

        <!-- Tab: Social Posts -->
        <div class="mke-panel" id="mkePanel-social">
          <div class="mke-panel-header">
            <div>
              <h3 class="mke-panel-title">Social Media Post Library</h3>
              <p class="mke-panel-sub">Ready-to-use posts based on your actual products and customer data</p>
            </div>
            <button class="mke-btn primary" id="mkeGenMore">Generate More</button>
          </div>
          <div class="mke-social-filters" id="mkeSocialFilters"></div>
          <div id="mkeSocialGrid" class="mke-social-grid">
            <div class="ai-loading">Loading social posts...</div>
          </div>
        </div>

        <!-- Tab: Email Campaigns -->
        <div class="mke-panel" id="mkePanel-emails">
          <div class="mke-panel-header">
            <div>
              <h3 class="mke-panel-title">Email Campaigns</h3>
              <p class="mke-panel-sub">Ready-to-send campaigns with personalization placeholders</p>
            </div>
          </div>
          <div id="mkeEmailList" class="mke-email-list">
            <div class="ai-loading">Building email campaigns...</div>
          </div>
        </div>

        <!-- Tab: Promotions -->
        <div class="mke-panel" id="mkePanel-promos">
          <div class="mke-panel-header">
            <div>
              <h3 class="mke-panel-title">Promotion Ideas</h3>
              <p class="mke-panel-sub">Data-driven promotions with full execution plans</p>
            </div>
          </div>
          <div id="mkePromoList" class="mke-promo-list">
            <div class="ai-loading">Crafting promotions...</div>
          </div>
        </div>

        <!-- Tab: Performance -->
        <div class="mke-panel" id="mkePanel-performance">
          <div class="mke-panel-header">
            <div>
              <h3 class="mke-panel-title">Marketing Performance</h3>
              <p class="mke-panel-sub">Track your marketing content usage and estimated impact</p>
            </div>
          </div>
          <div id="mkePerfContent">
            <div class="ai-loading">Loading performance data...</div>
          </div>
        </div>
      </section>

      <!-- Win-Back Campaigns Section -->
      <section class="section {{ 'active' if sec == 'winback' }}" id="sec-winback">
        <!-- Customer Status Overview -->
        <div class="wb-overview-grid" id="wbOverviewGrid">
          <div class="wb-metric-card">
            <div class="wb-metric-icon active-icon">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/></svg>
            </div>
            <div class="wb-metric-value" id="wbActive">--</div>
            <div class="wb-metric-label">Active Customers</div>
          </div>
          <div class="wb-metric-card">
            <div class="wb-metric-icon atrisk-icon">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"/><line x1="12" y1="9" x2="12" y2="13"/><line x1="12" y1="17" x2="12.01" y2="17"/></svg>
            </div>
            <div class="wb-metric-value" id="wbAtRisk">--</div>
            <div class="wb-metric-label">At-Risk</div>
          </div>
          <div class="wb-metric-card">
            <div class="wb-metric-icon lost-icon">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><line x1="15" y1="9" x2="9" y2="15"/><line x1="9" y1="9" x2="15" y2="15"/></svg>
            </div>
            <div class="wb-metric-value" id="wbLost">--</div>
            <div class="wb-metric-label">Lost</div>
          </div>
          <div class="wb-metric-card">
            <div class="wb-metric-icon wonback-icon">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="23 6 13.5 15.5 8.5 10.5 1 18"/><polyline points="17 6 23 6 23 12"/></svg>
            </div>
            <div class="wb-metric-value" id="wbWonBack">--</div>
            <div class="wb-metric-label">Won Back</div>
          </div>
        </div>

        <!-- Donut Chart -->
        <div class="card">
          <div class="card-header"><h3>Customer Health Distribution</h3></div>
          <div class="card-body" style="display:flex;align-items:center;justify-content:center;min-height:280px">
            <canvas id="wbDonutChart" style="max-width:320px;max-height:320px"></canvas>
          </div>
        </div>

        <!-- At-Risk Customers Table -->
        <div class="card mt">
          <div class="card-header">
            <h3>At-Risk Customers</h3>
            <div class="wb-table-actions">
              <select id="wbSortBy" class="wb-sort-select">
                <option value="days_since">Sort by: Days Since Visit</option>
                <option value="total_spent">Sort by: Lifetime Spend</option>
                <option value="visit_count">Sort by: Visit Count</option>
              </select>
            </div>
          </div>
          <div class="card-body wb-table-wrap">
            <table class="data-table" id="wbAtRiskTable">
              <thead>
                <tr>
                  <th><input type="checkbox" id="wbSelectAll"></th>
                  <th>Customer</th>
                  <th>Last Visit</th>
                  <th>Days Since</th>
                  <th>Lifetime Spend</th>
                  <th>Favorite Product</th>
                  <th>Visits</th>
                  <th>Action</th>
                </tr>
              </thead>
              <tbody></tbody>
            </table>
          </div>
        </div>

        <!-- Win-Back Campaign Templates -->
        <div class="card mt">
          <div class="card-header"><h3>Win-Back Campaign Templates</h3></div>
          <div class="card-body">
            <div class="wb-templates" id="wbTemplates">
              <div class="ai-loading">Loading templates...</div>
            </div>
          </div>
        </div>

        <!-- Campaign History -->
        <div class="card mt">
          <div class="card-header"><h3>Campaign History</h3></div>
          <div class="card-body">
            <table class="data-table" id="wbHistoryTable">
              <thead><tr><th>Campaign</th><th>Template</th><th>Customers</th><th>Discount</th><th>Status</th><th>Open Rate</th><th>Recovery</th><th>Date</th></tr></thead>
              <tbody></tbody>
            </table>
          </div>
        </div>

        <!-- Automation Settings -->
        <div class="card mt">
          <div class="card-header"><h3>Automation Settings</h3></div>
          <div class="card-body">
            <div class="wb-automation" id="wbAutomation">
              <div class="ai-loading">Loading settings...</div>
            </div>
          </div>
        </div>
      </section>

      <!-- Reviews Section -->
      <section class="section {{ 'active' if sec == 'reviews' }}" id="sec-reviews">
        <div class="kpi-grid small">
          <div class="kpi-card"><div class="kpi-label">Avg Rating</div><div class="kpi-value" id="revAvg">--</div></div>
          <div class="kpi-card"><div class="kpi-label">Total Reviews</div><div class="kpi-value" id="revTotal">--</div></div>
          <div class="kpi-card"><div class="kpi-label">Positive</div><div class="kpi-value" id="revPos">--</div></div>
          <div class="kpi-card"><div class="kpi-label">Negative</div><div class="kpi-value" id="revNeg">--</div></div>
        </div>
        <div class="card mt">
          <div class="card-header"><h3>Review Feed</h3></div>
          <div class="card-body">
            <div class="review-list" id="reviewList"></div>
          </div>
        </div>
      </section>

      <!-- Alerts Section -->
      <section class="section {{ 'active' if sec == 'alerts' }}" id="sec-alerts">
        <div class="card">
          <div class="card-header"><h3>All Alerts</h3></div>
          <div class="card-body">
            <div class="alert-list full" id="alertListFull"></div>
          </div>
        </div>
      </section>
    </div>
  </main>

  <!-- Mobile sidebar overlay -->
  <div class="sidebar-overlay" id="sidebarOverlay"></div>

  <!-- Keyboard Shortcuts Modal -->
  <div class="modal-overlay" id="shortcutsModal">
    <div class="shortcuts-modal">
      <div class="shortcuts-header">
        <h2>Keyboard Shortcuts</h2>
        <button class="shortcuts-close" id="shortcutsClose">&times;</button>
      </div>
      <div class="shortcuts-body">
        <div class="shortcut-row"><kbd>B</kbd><span>Daily Briefing</span></div>
        <div class="shortcut-row"><kbd>O</kbd><span>Overview</span></div>
        <div class="shortcut-row"><kbd>S</kbd><span>Sales</span></div>
        <div class="shortcut-row"><kbd>P</kbd><span>Products</span></div>
        <div class="shortcut-row"><kbd>U</kbd><span>Customers</span></div>
        <div class="shortcut-row"><kbd>C</kbd><span>Competitors</span></div>
        <div class="shortcut-row"><kbd>G</kbd><span>Goals</span></div>
        <div class="shortcut-row"><kbd>M</kbd><span>Marketing</span></div>
        <div class="shortcut-row"><kbd>W</kbd><span>Win-Back</span></div>
        <div class="shortcut-row"><kbd>/</kbd><span>Focus search</span></div>
        <div class="shortcut-row"><kbd>?</kbd><span>Show this help</span></div>
        <div class="shortcut-row"><kbd>Esc</kbd><span>Close modals</span></div>
      </div>
    </div>
  </div>

  <script>
    window.__ACTIVE_SECTION = "{{ active_section|default('overview') }}";
    window.__SUB_SECTION = "{{ sub_section|default('') }}";
    window.__WELCOME = "{{ welcome|default('') }}";
  </script>
  <script src="/static/dashboard.js?v=13"></script>
</body>
</html>
